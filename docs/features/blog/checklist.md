# üìù Checklist Tri·ªÉn Khai H·ªá Th·ªëng Blog

## üìã T·ªïng quan
- **D·ª± √°n**: H·ªá th·ªëng Blog/L√Ω thuy·∫øt NyNus
- **Ki·∫øn tr√∫c**: gRPC-only, Client-side KaTeX, TikZ cloud images
- **Tech Stack**: 
  - Backend: Go + gRPC + PostgreSQL
  - Frontend: Next.js 15 + React 19 + TypeScript + KaTeX
  - Storage: Cloudinary (images)
- **Ph·∫°m vi**: Blog, L√Ω thuy·∫øt, Math Notes v·ªõi quy tr√¨nh duy·ªát b√†i

---

## üóÑÔ∏è Backend & Database

### Phase 1: Database Schema (4-6 gi·ªù)
- [ ] **T·∫°o migration cho b·∫£ng ch√≠nh**
  - [ ] `posts` - b√†i vi·∫øt (id, slug, type, status, author_id, category_id, hero_asset_id, math_enabled, published_at)
  - [ ] `post_versions` - phi√™n b·∫£n b√†i (version, title, summary, markdown, macros, word_count, created_by, change_note)
  - [ ] `post_reviews` - l·ªãch s·ª≠ duy·ªát (reviewer_id, status, comment, decided_at)
  - [ ] `categories` - danh m·ª•c (slug, name, parent_id)
  - [ ] `tags` - th·∫ª (slug, name)
  - [ ] `post_tags` - li√™n k·∫øt b√†i-th·∫ª (N-N)

- [ ] **T·∫°o migration cho assets & TikZ**
  - [ ] `assets` - t√†i nguy√™n (kind, provider='CLOUDINARY', public_id, url, format, hash, width, height)
  - [ ] `post_assets` - li√™n k·∫øt b√†i-t√†i nguy√™n (usage: HERO/INLINE/ATTACHMENT)
  - [ ] `tikz_templates` - m·∫´u TikZ (name, engine, output_format, preamble, timeout_seconds)
  - [ ] `tikz_sources` - m√£ TikZ (template_id, code, code_hash, compiled_asset_id, compile_status, error_log)

- [ ] **T·∫°o migration cho import**
  - [ ] `import_jobs` - job nh·∫≠p li·ªáu (source_type, status, options_json, error_log)
  - [ ] `import_results` - k·∫øt qu·∫£ import (import_job_id, post_id, section, status, note)

- [ ] **Indexes & Constraints**
  - [ ] Unique index tr√™n `posts.slug`
  - [ ] Index `(status, published_at desc)` cho posts
  - [ ] Index `(type, published_at desc)` cho filter theo lo·∫°i
  - [ ] Unique index tr√™n `assets.hash` cho dedup
  - [ ] Unique index tr√™n `tikz_sources.code_hash` cho cache

### Phase 2: gRPC Services Implementation (8-10 gi·ªù)

#### BlogService
- [ ] **CRUD Operations**
  - [ ] `CreatePost` - t·∫°o b√†i nh√°p (validate slug ASCII, set status=DRAFT)
  - [ ] `UpdatePost` - c·∫≠p nh·∫≠t (t·∫°o version m·ªõi, gi·ªØ version c≈©)
  - [ ] `GetPost` - l·∫•y b√†i theo id/slug (JOIN v·ªõi current_version)
  - [ ] `ListPosts` - danh s√°ch v·ªõi filters (category, type, tags, status, pagination)
  - [ ] `DeletePost` - soft delete (status=ARCHIVED)

- [ ] **Moderation Flow** 
  - [ ] `SubmitForReview` - chuy·ªÉn status DRAFT ‚Üí PENDING_REVIEW
  - [ ] `ApprovePost` - duy·ªát b√†i (status ‚Üí APPROVED, ghi post_reviews)
  - [ ] `PublishPost` - xu·∫•t b·∫£n (status ‚Üí PUBLISHED, set published_at)
  - [ ] `UnpublishPost` - g·ª° xu·∫•t b·∫£n
  - [ ] **Interceptor ki·ªÉm tra role ADMIN** cho t·∫•t c·∫£ RPCs

#### TikzCompilerService (Python microservice)
- [ ] **Core Compiler**
  - [ ] Setup Python service v·ªõi gRPC server
  - [ ] Container Docker: python:3.11 + texlive + poppler + cloudinary
  - [ ] Port code t·ª´ `tools/image/core/tikz_compiler.py`
  - [ ] Mapping template_id ‚Üí preamble (t·ª´ settings.py)

- [ ] **Compile Flow**
  - [ ] `CompileTikz` - nh·∫≠n template_id + code
  - [ ] Check cache theo hash(template_id + code)
  - [ ] N·∫øu cache hit: tr·∫£ AssetRef t·ª´ DB
  - [ ] N·∫øu cache miss:
    - [ ] Compile v·ªõi pdflatex ‚Üí PDF
    - [ ] Convert PDF ‚Üí image (format theo template)
    - [ ] Crop whitespace + padding
    - [ ] Upload Cloudinary, nh·∫≠n url/public_id
    - [ ] L∆∞u DB assets + tikz_sources
    - [ ] Tr·∫£ AssetRef
  - [ ] `ListTemplates` - danh s√°ch template kh·∫£ d·ª•ng

- [ ] **Cloudinary Integration**
  - [ ] Config SDK v·ªõi api_key/secret t·ª´ env
  - [ ] Upload v·ªõi folder structure: `tikz/{year}/{month}/{hash[0:2]}/`
  - [ ] Set transformation params n·∫øu c·∫ßn

#### SearchService
- [ ] **Indexing**
  - [ ] Build index t·ª´ posts (title, markdown text, tags, category)
  - [ ] Normalize ti·∫øng Vi·ªát (b·ªè d·∫•u option)
  - [ ] Store index trong memory/Redis

- [ ] **Search RPC**
  - [ ] `Search` - streaming results
  - [ ] Filter theo category/type/tags
  - [ ] Score v√† sort theo relevance
  - [ ] Generate snippet v·ªõi highlight

#### ImportService  
- [ ] **File Processing**
  - [ ] `UploadImportFile` - client-stream nh·∫≠n DOCX/PDF
  - [ ] Store temp file ho·∫∑c upload Cloudinary
  - [ ] `CreateImportJob` - t·∫°o job v·ªõi options
  - [ ] Background worker:
    - [ ] DOCX ‚Üí Markdown (pandoc/mammoth)
    - [ ] PDF ‚Üí text/Markdown (pdfplumber/OCR)
    - [ ] Google Docs ‚Üí fetch via API/export URL
    - [ ] Split theo headings n·∫øu c·∫•u h√¨nh
    - [ ] Create posts v·ªõi status=DRAFT
  - [ ] `GetImportStatus` - tr·∫°ng th√°i job
  - [ ] `ListImportResults` - danh s√°ch b√†i ƒë∆∞·ª£c t·∫°o

### Phase 3: Authentication & Authorization (3-4 gi·ªù)
- [ ] **JWT/Session Management**
  - [ ] Interceptor ki·ªÉm tra token cho protected RPCs
  - [ ] Extract user_id, role t·ª´ claims
  - [ ] Validate role=ADMIN cho BlogService operations

- [ ] **Rate Limiting**
  - [ ] Rate limit cho TikzCompilerService
  - [ ] Throttle ImportService uploads
  - [ ] DDoS protection cho Search

### Phase 4: Testing & Deployment (4-5 gi·ªù)
- [ ] **Unit Tests**
  - [ ] Test CRUD operations
  - [ ] Test moderation flow
  - [ ] Test TikZ cache logic
  - [ ] Test search normalization

- [ ] **Integration Tests**
  - [ ] E2E flow: Create ‚Üí Review ‚Üí Publish
  - [ ] TikZ compile v·ªõi nhi·ªÅu templates
  - [ ] Import file th·ª±c t·∫ø

- [ ] **Deployment**
  - [ ] Dockerfile cho Go service
  - [ ] Dockerfile cho Python TikZ service
  - [ ] docker-compose v·ªõi PostgreSQL
  - [ ] Environment configs (dev/staging/prod)

---

## üíª Frontend

### Phase 1: Setup & Core Components (4-5 gi·ªù)

- [ ] **Project Structure**
  - [ ] T·∫°o folders: `src/app/blog/`, `src/app/theory/`, `src/app/admin/blog/`
  - [ ] Types: `src/types/blog.ts`, `src/types/tikz.ts`
  - [ ] Services: `src/services/blog.service.ts`, `src/services/tikz.service.ts`
  - [ ] Hooks: `src/hooks/useBlog.ts`, `src/hooks/useKatex.ts`

- [ ] **gRPC-Web Client Setup**
  - [ ] Generate TypeScript t·ª´ proto files
  - [ ] Setup grpc-web client v·ªõi interceptors
  - [ ] Auth interceptor th√™m token
  - [ ] Error handling wrapper

- [ ] **KaTeX Configuration**
  - [ ] Install katex, @types/katex
  - [ ] Config auto-render v·ªõi delimiters: $, $$, \\(, \\), \\[, \\]
  - [ ] Set output: 'htmlAndMathml' cho SEO/accessibility
  - [ ] Create `ClientMathRenderer` component

### Phase 2: Public Blog Interface (6-8 gi·ªù)

- [ ] **Blog Homepage** (`/blog`)
  - [ ] List posts v·ªõi pagination
  - [ ] Filter theo category/tags
  - [ ] Search box (g·ªçi SearchService)
  - [ ] Card components cho post preview
  - [ ] Mobile-first responsive design

- [ ] **Post Detail Page** (`/blog/[slug]`)
  - [ ] Fetch markdown qua BlogService.GetPost
  - [ ] Parse Markdown client-side
  - [ ] Sanitize v·ªõi DOMPurify
  - [ ] Render KaTeX v·ªõi auto-render
  - [ ] Display TikZ images t·ª´ Cloudinary URLs
  - [ ] TOC (Table of Contents) generation
  - [ ] Share buttons
  - [ ] Related posts

- [ ] **Theory Section** (`/theory`)
  - [ ] Navigation theo m√¥n h·ªçc/l·ªõp
  - [ ] Breadcrumb navigation
  - [ ] Mobile swipe navigation
  - [ ] Progress tracking

- [ ] **Search Interface**
  - [ ] Real-time search v·ªõi debounce
  - [ ] Display streaming results
  - [ ] Highlight matched terms
  - [ ] Filter sidebar

### Phase 3: Admin Interface (8-10 gi·ªù)

- [ ] **Admin Dashboard** (`/admin/blog`)
  - [ ] Statistics cards (total posts, pending review, etc.)
  - [ ] Recent activity
  - [ ] Quick actions

- [ ] **Post Management** (`/admin/blog/posts`)
  - [ ] DataTable v·ªõi posts list
  - [ ] Status badges
  - [ ] Bulk actions
  - [ ] Quick edit/delete

- [ ] **Post Editor** (`/admin/blog/editor`)
  - [ ] Monaco Editor cho Markdown
  - [ ] Split view: Editor | Preview
  - [ ] Live KaTeX preview
  - [ ] Metadata form (title, slug, category, tags)
  - [ ] Save draft auto-save
  - [ ] Submit for review button

- [ ] **TikZ Compiler UI** (`/admin/blog/tikz`)
  - [ ] Template selector (fetch t·ª´ ListTemplates)
  - [ ] Code editor cho TikZ
  - [ ] Compile button ‚Üí g·ªçi CompileTikz
  - [ ] Preview compiled image
  - [ ] Copy URL button
  - [ ] History c·ªßa compiled images

- [ ] **Import Tool** (`/admin/blog/import`)
  - [ ] File uploader (drag & drop)
  - [ ] Source type selector (DOCX/PDF/Google Docs)
  - [ ] Options config (split by heading, etc.)
  - [ ] Progress bar cho upload
  - [ ] Job status monitoring
  - [ ] Results table v·ªõi links

- [ ] **Review Queue** (`/admin/blog/review`)
  - [ ] List pending posts
  - [ ] Preview v·ªõi diff highlighting
  - [ ] Approve/Reject v·ªõi comment
  - [ ] Batch review

### Phase 4: Performance & UX (4-5 gi·ªù)

- [ ] **Optimization**
  - [ ] Lazy loading cho posts list
  - [ ] Virtual scroll cho long content
  - [ ] Image lazy loading v·ªõi blur placeholder
  - [ ] Code splitting per route
  - [ ] Preload critical fonts (KaTeX)

- [ ] **KaTeX Performance**
  - [ ] Chunk rendering cho nhi·ªÅu c√¥ng th·ª©c
  - [ ] IntersectionObserver cho viewport rendering
  - [ ] Web Worker cho heavy processing (optional)
  - [ ] Cache rendered formulas

- [ ] **Mobile Experience**
  - [ ] Touch gestures cho navigation
  - [ ] Responsive KaTeX scaling
  - [ ] Bottom sheet cho filters
  - [ ] PWA configuration
  - [ ] Offline reading v·ªõi cache

- [ ] **Accessibility**
  - [ ] ARIA labels cho navigation
  - [ ] Keyboard shortcuts
  - [ ] Focus management
  - [ ] Screen reader support cho math (MathML)
  - [ ] High contrast mode

### Phase 5: Testing & QA (3-4 gi·ªù)

- [ ] **Component Tests**
  - [ ] Test ClientMathRenderer
  - [ ] Test sanitization
  - [ ] Test search debounce
  - [ ] Test form validation

- [ ] **E2E Tests (Playwright/Cypress)**
  - [ ] User flow: Browse ‚Üí Read ‚Üí Search
  - [ ] Admin flow: Create ‚Üí Edit ‚Üí Publish
  - [ ] TikZ compile flow
  - [ ] Import flow

- [ ] **Performance Tests**
  - [ ] Lighthouse score > 90
  - [ ] Time to first math < 500ms
  - [ ] Search response < 200ms
  - [ ] Bundle size analysis

---

## üîß DevOps & Deployment

### Infrastructure (4-5 gi·ªù)
- [ ] **Docker Setup**
  - [ ] docker-compose.yml v·ªõi services:
    - [ ] PostgreSQL
    - [ ] Go gRPC server
    - [ ] Python TikZ compiler
    - [ ] Redis (for search index)
  - [ ] Volume mounts
  - [ ] Network configuration

- [ ] **CI/CD Pipeline**
  - [ ] GitHub Actions/GitLab CI
  - [ ] Proto compilation check
  - [ ] Run tests
  - [ ] Build Docker images
  - [ ] Push to registry

- [ ] **Monitoring**
  - [ ] Health check endpoints
  - [ ] Prometheus metrics
  - [ ] Error tracking (Sentry)
  - [ ] Performance monitoring

---

## üìä ∆Ø·ªõc t√≠nh th·ªùi gian

### Backend Team
- Database & Migration: 4-6 gi·ªù
- gRPC Services: 8-10 gi·ªù  
- Auth & Security: 3-4 gi·ªù
- Testing: 4-5 gi·ªù
- **T·ªïng Backend: 19-25 gi·ªù**

### Frontend Team
- Setup & Core: 4-5 gi·ªù
- Public Interface: 6-8 gi·ªù
- Admin Interface: 8-10 gi·ªù
- Performance & UX: 4-5 gi·ªù
- Testing: 3-4 gi·ªù
- **T·ªïng Frontend: 25-32 gi·ªù**

### DevOps
- Infrastructure: 4-5 gi·ªù
- **T·ªïng DevOps: 4-5 gi·ªù**

**T·ªîNG C·ªòNG: 48-62 gi·ªù**

---

## üöÄ Milestones

### Milestone 1: Core Backend (Week 1)
- Database schema complete
- Basic CRUD APIs working
- TikZ compiler prototype

### Milestone 2: Frontend Foundation (Week 2)  
- Public blog interface
- KaTeX rendering working
- Basic admin CRUD

### Milestone 3: Advanced Features (Week 3)
- Full moderation flow
- Import functionality
- Search implementation

### Milestone 4: Polish & Deploy (Week 4)
- Performance optimization
- Testing complete
- Production deployment

---

## üìù Notes

- **∆Øu ti√™n**: Phase 1-2 c·ªßa c·∫£ Backend v√† Frontend c√≥ th·ªÉ l√†m song song
- **Dependency**: Frontend c·∫ßn Backend APIs ƒë·ªÉ test integration
- **Risk**: TikZ compiler service c√≥ th·ªÉ ph·ª©c t·∫°p, c·∫ßn prototype s·ªõm
- **Quality**: ƒê·∫£m b·∫£o pnpm type-check v√† pnpm lint pass tr∆∞·ªõc khi merge