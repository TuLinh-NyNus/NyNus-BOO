# Production Environment Configuration
# NyNus Exam Bank System - Production Settings

# ========================================
# ENVIRONMENT
# ========================================
ENV=production
LOG_LEVEL=info
LOG_FORMAT=json

# ========================================
# DATABASE CONFIGURATION
# ========================================
DB_HOST=postgres-prod.nynus.edu.vn
DB_PORT=5432
DB_USER=exam_bank_user
DB_PASSWORD=${DB_PASSWORD}  # Set via environment or secrets
DB_NAME=exam_bank_db
DB_SSL_MODE=require

# ========================================
# SERVER CONFIGURATION
# ========================================
GRPC_PORT=8080
HTTP_PORT=8081

# Production Security: Disable HTTP Gateway
HTTP_GATEWAY_ENABLED=false

# ========================================
# TLS/SSL CONFIGURATION
# ========================================
TLS_ENABLED=true
TLS_CERT_FILE=/etc/ssl/certs/nynus.crt
TLS_KEY_FILE=/etc/ssl/private/nynus.key

# ========================================
# JWT CONFIGURATION
# ========================================
JWT_SECRET=${JWT_SECRET}  # Must be set via environment
JWT_ACCESS_SECRET=${JWT_ACCESS_SECRET}
JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
JWT_EXPIRY_HOURS=1
JWT_REFRESH_EXPIRY_DAYS=7

# ========================================
# PERFORMANCE SETTINGS
# ========================================
MAX_CONCURRENT_STREAMS=2000       # Increased for higher concurrent load
MAX_RECEIVE_MESSAGE_SIZE=8388608  # 8MB for larger payloads
MAX_SEND_MESSAGE_SIZE=8388608     # 8MB for larger responses
CONNECTION_TIMEOUT=60             # 60 seconds for production stability
KEEPALIVE_TIME=30                 # 30 seconds keepalive
KEEPALIVE_TIMEOUT=5               # 5 seconds keepalive timeout

# ========================================
# RATE LIMITING
# ========================================
ENABLE_RATE_LIMIT=true
RATE_LIMIT_RPS=200        # Increased for higher throughput
RATE_LIMIT_BURST=500      # Higher burst capacity for traffic spikes

# ========================================
# LOGGING CONFIGURATION
# ========================================
ENABLE_ACCESS_LOG=true
ENABLE_ERROR_LOG=true

# ========================================
# HEALTH CHECK & MONITORING
# ========================================
ENABLE_HEALTH_CHECK=true
HEALTH_CHECK_PATH=/health
ENABLE_METRICS=true
METRICS_PORT=9090
ENABLE_TRACING=true

# ========================================
# EMAIL CONFIGURATION (SMTP)
# ========================================
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=${SMTP_USERNAME}
SMTP_PASSWORD=${SMTP_PASSWORD}
SMTP_FROM_EMAIL=noreply@nynus.edu.vn
SMTP_FROM_NAME=NyNus System

# ========================================
# OAUTH CONFIGURATION
# ========================================
GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}

# ========================================
# FRONTEND CONFIGURATION
# ========================================
FRONTEND_URL=https://app.nynus.edu.vn
ADMIN_URL=https://admin.nynus.edu.vn

# ========================================
# GOOGLE DRIVE CONFIGURATION
# ========================================
GOOGLE_DRIVE_ENABLED=true
DRIVE_CLIENT_ID=${DRIVE_CLIENT_ID}
DRIVE_CLIENT_SECRET=${DRIVE_CLIENT_SECRET}
DRIVE_REFRESH_TOKEN=${DRIVE_REFRESH_TOKEN}
DRIVE_ROOT_FOLDER_ID=${DRIVE_ROOT_FOLDER_ID}

# ========================================
# IMAGE PROCESSING CONFIGURATION
# ========================================
IMAGE_PROCESSING_ENABLED=true
TEXLIVE_BIN=/usr/local/texlive/2024/bin/x86_64-linux
LATEX_ENGINE=lualatex
IMAGE_CONVERTER=magick
IMAGE_TMP_DIR=/tmp/images
IMAGE_OUTPUT_DIR=/var/lib/nynus/images
IMAGE_CACHE_DIR=/var/cache/nynus/images

# ========================================
# SECURITY HEADERS
# ========================================
# These are handled by the application code
# X-Content-Type-Options: nosniff
# X-Frame-Options: DENY
# X-XSS-Protection: 1; mode=block
# Strict-Transport-Security: max-age=31536000; includeSubDomains
# Content-Security-Policy: default-src 'self'
# Referrer-Policy: strict-origin-when-cross-origin

# ========================================
# CORS CONFIGURATION
# ========================================
# Production CORS settings are restrictive
# Allowed origins: https://nynus.edu.vn, https://app.nynus.edu.vn, https://admin.nynus.edu.vn

# ========================================
# DEPLOYMENT NOTES
# ========================================
# 1. Set all ${VARIABLE} values via environment variables or secrets management
# 2. Ensure TLS certificates are properly configured
# 3. Database should use SSL/TLS connection
# 4. HTTP Gateway is disabled for security
# 5. Rate limiting is enabled
# 6. Structured JSON logging is enabled
# 7. Health checks and metrics are enabled
# 8. All secrets should be managed via secure methods (not in this file)

# ========================================
# REQUIRED SECRETS (Set via environment)
# ========================================
# DB_PASSWORD - Database password
# JWT_SECRET - JWT signing secret (256-bit)
# JWT_ACCESS_SECRET - Access token secret
# JWT_REFRESH_SECRET - Refresh token secret
# SMTP_USERNAME - SMTP authentication username
# SMTP_PASSWORD - SMTP authentication password
# GOOGLE_CLIENT_ID - Google OAuth client ID
# GOOGLE_CLIENT_SECRET - Google OAuth client secret
# DRIVE_CLIENT_ID - Google Drive API client ID
# DRIVE_CLIENT_SECRET - Google Drive API client secret
# DRIVE_REFRESH_TOKEN - Google Drive API refresh token
# DRIVE_ROOT_FOLDER_ID - Google Drive root folder ID

# ========================================
# KUBERNETES DEPLOYMENT EXAMPLE
# ========================================
# apiVersion: v1
# kind: Secret
# metadata:
#   name: nynus-secrets
# type: Opaque
# data:
#   db-password: <base64-encoded-password>
#   jwt-secret: <base64-encoded-secret>
#   smtp-password: <base64-encoded-password>
#   # ... other secrets
#
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: nynus-backend
# spec:
#   template:
#     spec:
#       containers:
#       - name: backend
#         image: nynus/backend:latest
#         envFrom:
#         - configMapRef:
#             name: nynus-config
#         - secretRef:
#             name: nynus-secrets
#         ports:
#         - containerPort: 8080
#           name: grpc
#         # No HTTP port exposed in production

# ========================================
# DOCKER COMPOSE PRODUCTION EXAMPLE
# ========================================
# version: '3.8'
# services:
#   backend:
#     image: nynus/backend:latest
#     environment:
#       - ENV=production
#       - HTTP_GATEWAY_ENABLED=false
#       - DB_PASSWORD=${DB_PASSWORD}
#       - JWT_SECRET=${JWT_SECRET}
#     ports:
#       - "8080:8080"  # Only gRPC port
#     volumes:
#       - /etc/ssl/certs:/etc/ssl/certs:ro
#       - /etc/ssl/private:/etc/ssl/private:ro
