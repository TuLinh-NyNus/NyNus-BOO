syntax = "proto3";

package v1;

import "common/common.proto";

option go_package = "exam-bank-system/apps/backend/pkg/proto/v1";

// Nguá»“n nháº­p liá»‡u
enum ImportSourceType {
  IMPORT_SOURCE_TYPE_UNSPECIFIED = 0;
  IMPORT_SOURCE_TYPE_DOCX = 1;
  IMPORT_SOURCE_TYPE_GOOGLE_DOCS = 2;
  IMPORT_SOURCE_TYPE_PDF = 3;
}

// Tráº¡ng thÃ¡i job import
enum ImportStatus {
  IMPORT_STATUS_UNSPECIFIED = 0;
  IMPORT_STATUS_PENDING = 1;
  IMPORT_STATUS_PROCESSING = 2;
  IMPORT_STATUS_SUCCESS = 3;
  IMPORT_STATUS_FAILED = 4;
}

// Upload file nháº­p liá»‡u theo dáº¡ng client-streaming
message FileChunk {
  string file_name = 1;   // tÃªn file gá»‘c
  bytes data = 2;         // dá»¯ liá»‡u nhá»‹ phÃ¢n
}

message UploadImportFileResponse {
  common.Response response = 1;
  string upload_asset_id = 2; // ID asset Ä‘Ã£ lÆ°u (Cloudinary/Storage)
}

message CreateImportJobRequest {
  ImportSourceType source_type = 1;   // DOCX/GOOGLE_DOCS/PDF
  string source_url = 2;              // náº¿u nháº­p tá»« URL (Google Docs public/export)
  string upload_asset_id = 3;         // náº¿u Ä‘Ã£ upload file qua UploadImportFile
  string options_json = 4;            // cáº¥u hÃ¬nh tÃ¡ch bÃ i, mapping category...
}

message ImportJob {
  string id = 1;
  ImportStatus status = 2;
  string error_log = 3;
  int64 created_at = 4;
  int64 updated_at = 5;
}

message CreateImportJobResponse {
  common.Response response = 1;
  ImportJob job = 2;
}

message GetImportStatusRequest { string import_job_id = 1; }
message GetImportStatusResponse { common.Response response = 1; ImportJob job = 2; }

message ImportResult {
  string id = 1;
  string import_job_id = 2;
  string post_id = 3;    // bÃ i viáº¿t táº¡o ra
  string section = 4;    // pháº§n/heading tÆ°Æ¡ng á»©ng (náº¿u cÃ³)
  string note = 5;
}

message ListImportResultsRequest { string import_job_id = 1; }
message ListImportResultsResponse { common.Response response = 1; repeated ImportResult results = 2; }

service ImportService {
  // Táº£i file lá»›n (DOCX/PDF) báº±ng client-streaming
  rpc UploadImportFile(stream FileChunk) returns (UploadImportFileResponse);

  // Táº¡o job import tá»« file Ä‘Ã£ upload hoáº·c tá»« URL
  rpc CreateImportJob(CreateImportJobRequest) returns (CreateImportJobResponse);

  // Theo dÃµi tráº¡ng thÃ¡i job
  rpc GetImportStatus(GetImportStatusRequest) returns (GetImportStatusResponse);

  // Káº¿t quáº£ import (nhiá»u bÃ i/section)
  rpc ListImportResults(ListImportResultsRequest) returns (ListImportResultsResponse);
}

